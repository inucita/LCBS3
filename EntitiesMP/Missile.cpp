/*
 * This file is generated by Entity Class Compiler, (c) CroTeam 1997-98
 */

#line 4 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"

#include "stdH.h"
#include <Engine/Math/Quaternion.h>
#include <Engine/Effect/CTag.h>
#include <Engine/Effect/CRefCountPtr.h>
#include <Engine/Effect/CEntityTag.h>
#include <Engine/Effect/CTagManager.h>
#include <Engine/Math/AdditionalFunction.h>
#include <Engine/Effect/CEffectGroup.h>

#include "EntitiesMP/Player.h"
#include "EntitiesMP/EnemyBase.h"
#include "EntitiesMP/CharacterBase.h"
#include <Engine/Entities/InternalClasses.h>
#include <Engine/Interface/UIManager.h>
#include <Engine/Effect/CSampleSpline.h>
#include <Engine/Effect/CMdlEffect.h>
#include <Engine/Entities/Skill.h>
#include <Engine/World/WorldRayCasting.h>
#include <Engine/Network/MessageDefine.h>

typedef CSampleSpline< FLOAT3D, CCubicSplineInterpolate<FLOAT3D> > cubic_spline;
#define GetSpline() (*((cubic_spline*)m_pssPath))

// NOTE : 심하게 밀리는 싱글던젼...
#define	EXTREAM_SINGLEDUNGEON		(10)


#include <EntitiesMP/Missile.h>
#include <EntitiesMP/Missile_tables.h>
#line 48 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"

#include <Engine/Effect/CTag.h>
#include <Engine/Effect/CTagManager.h>
#include <Engine/Ska/ModelInstance.h>
void ShotMissile(CEntity *penShoter, const char *szShotPosTagName
				 , CEntity *penTarget, FLOAT fMoveSpeed
				 , const char *szHitEffectName, const char *szArrowEffectName
				 , bool bCritical
				 , FLOAT fHorizonalOffset = 0.0f, FLOAT fVerticalOffset = 0.0f	//-1.0f ~ 1.0f
				 , INDEX iArrowType = 0, const char *szMissileModel = NULL)		// iArrowType=0 : normal arrow, iArrowType=1 : magic arrow, iArrowType=etc : ??
{
	//입력 조건 검사.
	ASSERT(penShoter != NULL && penShoter->en_pmiModelInstance != NULL);
	ASSERT(penTarget != NULL && penTarget->en_pmiModelInstance != NULL && fMoveSpeed > 0.0f);
	ASSERT(szShotPosTagName != NULL && szHitEffectName != NULL && szArrowEffectName != NULL);
	ASSERT(fHorizonalOffset <= 1.0f && fHorizonalOffset >= -1.0f);
	ASSERT(fVerticalOffset <= 1.0f && fVerticalOffset >= -1.0f);
	if(!(penShoter != NULL && penShoter->en_pmiModelInstance != NULL)) return;
	if(!(penTarget != NULL && penTarget->en_pmiModelInstance != NULL && fMoveSpeed > 0.0f)) return;
	if(!(szShotPosTagName != NULL && szHitEffectName != NULL && szArrowEffectName != NULL)) return;

	//missile 생성.
	CTag *pTag = penShoter->en_pmiModelInstance->m_tmSkaTagManager.Find(szShotPosTagName);
	//if(pTag == NULL) pTag = penShoter->m_ptmTagManager->Find(szShotPosTagName);
	ASSERT(pTag != NULL);
	if(pTag == NULL) return;
	CPlacement3D plMissile;
	plMissile.pl_PositionVector = pTag->CurrentTagInfo().m_vPos;
	plMissile.pl_OrientationAngle = GetEulerAngleFromDir(penTarget->en_plPlacement.pl_PositionVector - penShoter->en_plPlacement.pl_PositionVector);
	CMissile *penMissile = (CMissile *)penShoter->en_pwoWorld->CreateEntity_t(plMissile, "classes\\missile.ecl");

	//missile 정보 세팅.
	penMissile->m_epSource = penShoter;
	penMissile->m_epTarget = penTarget;	//target entity
	penMissile->m_fMoveSpeed = fMoveSpeed;
	penMissile->m_fHorizonalOffset = fHorizonalOffset;
	penMissile->m_fVerticalOffset = fVerticalOffset;
	penMissile->m_strHitEffect = szHitEffectName;
	if(iArrowType == 0)
	{
		penMissile->m_eMissileType = MLT_NORMALARROW;
		penMissile->m_fnModel = CTFileName("data\\effect\\ska\\ArrowNormal.smc");	//Hardcoding
	}
	else if(iArrowType == 1 )
	{
		penMissile->m_eMissileType = MLT_SOMETHING;
		penMissile->m_fAfterDelay = 0.0f;
		penMissile->m_fnModel = CTFileName("data\\effect\\ska\\magic_arr.smc");	//Hardcoding
	}
	else
	{
		penMissile->m_eMissileType = MLT_SOMETHING;
		penMissile->m_fAfterDelay = 0.0f;
		penMissile->m_fnModel = szMissileModel;
	}
	penMissile->m_bNoPeak = FALSE;
	penMissile->Initialize();
	
	penMissile->m_bNormalHit = TRUE;
	penMissile->m_bCritical = bCritical;
	penMissile->m_ulTargetID = penMissile->en_ulID;

	//Tag 및 Effect 관련 세팅
	if(penMissile->en_pmiModelInstance != NULL)
	{
		penMissile->en_pmiModelInstance->RefreshTagManager();
		penMissile->en_pmiModelInstance->m_tmSkaTagManager.SetOwner(penMissile);
		penMissile->m_pMyEffectGroup = StartEffectGroup(szArrowEffectName
			, &penMissile->en_pmiModelInstance->m_tmSkaTagManager, _pTimer->GetLerpedCurrentTick());
	}
}

//orbit type
//-1 : nothing
//0 : Default(invisible)
//1 : Cutter
void ShotMagicContinued(CEntity *penShoter, FLOAT3D vStartPos, FLOATquat3D qStartRot
				 , CEntity *penTarget, FLOAT fMoveSpeed
				 , const char *szHitEffectName, const char *szMagicEffectName
				 , bool bCritical, INDEX iOrbitType, BOOL bDirectTag = FALSE)
{
	//입력 조건 검사.
	ASSERT(penShoter != NULL && penShoter->en_pmiModelInstance != NULL);
	ASSERT(penTarget != NULL && penTarget->en_pmiModelInstance != NULL && fMoveSpeed > 0.0f);
	if(!(penShoter != NULL && penShoter->en_pmiModelInstance != NULL)) return;
	if(!(penTarget != NULL && penTarget->en_pmiModelInstance != NULL && fMoveSpeed > 0.0f)) return;
	if(!(szHitEffectName != NULL && szMagicEffectName != NULL)) return;

	//missile 생성.
	CPlacement3D plMissile;
	plMissile.pl_PositionVector = vStartPos;
	plMissile.pl_OrientationAngle = GetEulerAngleFromQuaternion(qStartRot);
	//plMissile.pl_OrientationAngle = GetEulerAngleFromDir(penTarget->en_plPlacement.pl_PositionVector - penShoter->en_plPlacement.pl_PositionVector);
	CMissile *penMissile = (CMissile *)penShoter->en_pwoWorld->CreateEntity_t(plMissile, "classes\\missile.ecl");

	//missile 정보 세팅.
	penMissile->m_epSource = penShoter;
	penMissile->m_epTarget = penTarget;	//target entity
	penMissile->m_fMoveSpeed = fMoveSpeed;
	penMissile->m_strHitEffect = szHitEffectName;
	penMissile->m_eMissileType = MLT_SOMETHING;
	penMissile->m_bDirectTag = bDirectTag;
	penMissile->m_iFireObjectType = iOrbitType; // 스킬 오브젝트 타입
	if(iOrbitType == CSkill::MT_MAGECUTTER)
	{
		static FLOAT angleSpeed = 90.0f;
		penMissile->m_aAngleSpeed = angleSpeed;
		penMissile->m_fnModel = CTFileName("data\\effect\\ska\\mCutter.smc");	//Hardcoding
		penMissile->m_fAfterDelay = 0.0f;
	}
	else	//Default
	{
		penMissile->m_fnModel = CTFileName("data\\effect\\ska\\invisible.smc");	//Hardcoding
		penMissile->m_fAfterDelay = 0.0f;
	}

	penMissile->m_bNormalHit = FALSE;
	penMissile->m_fHorizonalOffset = 0;
	penMissile->m_fVerticalOffset = 0.15f;
	penMissile->m_bNoPeak = TRUE;

	penMissile->Initialize();

	if(iOrbitType == CSkill::MT_MAGECUTTER && penMissile->en_pmiModelInstance)
	{
		static FLOAT3D qRot(0,0,0);
		penMissile->en_pmiModelInstance->mi_qvOffset.qRot.FromEuler(qRot);
		penMissile->en_pmiModelInstance->mi_vStretch *= 0.35f; 
		penMissile->en_pmiModelInstance->mi_colModelColor = 0x828282FF;
		penMissile->en_pmiModelInstance->AddAnimation(
			penMissile->en_pmiModelInstance->FindFirstAnimationID(), AN_LOOPING|AN_CLEAR, 1, 0);
	}

	penMissile->m_ulTargetID = penMissile->en_ulID;
	penMissile->m_bCritical = bCritical;

	//Tag 및 Effect 관련 세팅
	if(penMissile->en_pmiModelInstance != NULL)
	{
		penMissile->en_pmiModelInstance->RefreshTagManager();
		penMissile->en_pmiModelInstance->m_tmSkaTagManager.SetOwner(penMissile);
		penMissile->m_pMyEffectGroup = StartEffectGroup(szMagicEffectName
			, &penMissile->en_pmiModelInstance->m_tmSkaTagManager, _pTimer->GetLerpedCurrentTick());
	}
}

void ShotFallDown(FLOAT3D vStartPos, FLOAT3D vToTargetDir, FLOAT fMoveSpeed
				 , const char *szHitEffectName, const char *szFallObjEffectName
				 , bool bCritical)
{
	ASSERT(szHitEffectName != NULL && szFallObjEffectName != NULL);
	ASSERT(vToTargetDir.Length() > 0.99f && vToTargetDir.Length() < 1.01f);

	//Target 위치 계산 by ray cast
	FLOAT3D vTargetPos;
	FLOAT fMaxY = -9999999.0f;
	BOOL bFloorHitted = FALSE;
	FLOAT3D vSource = vStartPos;
	FLOAT3D vTarget = vStartPos - vToTargetDir * 100.0f;
	CCastRay crRay(NULL, vSource, vTarget);
	crRay.cr_ttHitModels = CCastRay::TT_NONE; // CCastRay::TT_FULLSEETHROUGH;
	crRay.cr_bHitTranslucentPortals = TRUE;
	crRay.cr_bPhysical = TRUE;
	CEntity *pen = CEntity::GetPlayerEntity(0);
	pen->GetWorld()->CastRay(crRay);
	if( (crRay.cr_penHit != NULL) && (crRay.cr_vHit(2) > fMaxY)) 
	{
		bFloorHitted = TRUE;
	}
	if(bFloorHitted)
	{
		vTargetPos = crRay.cr_vHit;
	}
	else
	{
		return;
	}
	
	//missile 생성.
	CPlacement3D plMissile;
	plMissile.pl_PositionVector = vStartPos;
	plMissile.pl_OrientationAngle = GetEulerAngleFromDir(vTargetPos - vStartPos);
	CMissile *penMissile = (CMissile *)pen->en_pwoWorld->CreateEntity_t(plMissile, "classes\\missile.ecl");

	//missile 정보 세팅.
	penMissile->m_fnModel = CTFileName("data\\effect\\ska\\invisible.smc");	//Hardcoding
	penMissile->m_bEntityTarget = FALSE;
	penMissile->m_vTargetPos = vTargetPos;
	penMissile->m_fMoveSpeed = fMoveSpeed;
	penMissile->m_strHitEffect = szHitEffectName;
	penMissile->m_eMissileType = MLT_FALLDOWN;
	penMissile->m_bNormalHit = FALSE;
	penMissile->m_fHorizonalOffset = 0;
	penMissile->m_fVerticalOffset = 0.15f;
	penMissile->m_bNoPeak = TRUE;
	penMissile->Initialize();

	penMissile->m_bCritical = bCritical;
	penMissile->m_ulTargetID = penMissile->en_ulID;

	//Tag 및 Effect 관련 세팅
	if(penMissile->en_pmiModelInstance != NULL)
	{
		penMissile->en_pmiModelInstance->RefreshTagManager();
		penMissile->en_pmiModelInstance->m_tmSkaTagManager.SetOwner(penMissile);
		penMissile->m_pMyEffectGroup = StartEffectGroup(szFallObjEffectName
			, &penMissile->en_pmiModelInstance->m_tmSkaTagManager, _pTimer->GetLerpedCurrentTick());
	}
}

void ShotGoWaitBack(CEntity *penShoter, FLOAT3D vStartPos, FLOATquat3D qStartRot
				 , CEntity *penTarget, FLOAT fMoveSpeed, FLOAT fWaitTime
				 , const char *szHitEffectName, const char *szMoveEffectName
				 , bool bCritical
				 , FLOAT fHorizonalOffset = 0.0f, FLOAT fVerticalOffset = 0.0f	//-1.0f ~ 1.0f
				 )
{
	//입력 조건 검사.
	ASSERT(penShoter != NULL && penShoter->en_pmiModelInstance != NULL);
	ASSERT(penTarget != NULL && penTarget->en_pmiModelInstance != NULL && fMoveSpeed > 0.0f);
	ASSERT(szHitEffectName != NULL && szMoveEffectName != NULL);
	ASSERT(fHorizonalOffset <= 1.0f && fHorizonalOffset >= -1.0f);
	ASSERT(fVerticalOffset <= 1.0f && fVerticalOffset >= -1.0f);
	if(!(penShoter != NULL && penShoter->en_pmiModelInstance != NULL)) return;
	if(!(penTarget != NULL && penTarget->en_pmiModelInstance != NULL && fMoveSpeed > 0.0f)) return;
	if(!(szHitEffectName != NULL && szMoveEffectName != NULL)) return;

	//missile 생성.
	CPlacement3D plMissile;
	plMissile.pl_PositionVector = vStartPos;
	plMissile.pl_OrientationAngle = GetEulerAngleFromQuaternion(qStartRot);
	CMissile *penMissile = (CMissile *)penShoter->en_pwoWorld->CreateEntity_t(plMissile, "classes\\missile.ecl");

	//missile 정보 세팅.
	penMissile->m_epSource = penShoter;
	penMissile->m_epTarget = penTarget;	//target entity
	penMissile->m_fMoveSpeed = fMoveSpeed;
	penMissile->m_fHorizonalOffset = fHorizonalOffset;
	penMissile->m_fVerticalOffset = fVerticalOffset;
	penMissile->m_strHitEffect = szHitEffectName;
	penMissile->m_fAfterDelay = fWaitTime;
	penMissile->m_eMissileType = MLT_GOWAITBACK;
	penMissile->m_strMoveEffect = szMoveEffectName;

	penMissile->m_bNoPeak = FALSE;
	penMissile->Initialize();
	
	penMissile->m_bNormalHit = TRUE;
	penMissile->m_bCritical = bCritical;
	penMissile->m_ulTargetID = penMissile->en_ulID;

	//Tag 및 Effect 관련 세팅
	if(penMissile->en_pmiModelInstance != NULL)
	{
		penMissile->en_pmiModelInstance->RefreshTagManager();
		penMissile->en_pmiModelInstance->m_tmSkaTagManager.SetOwner(penMissile);
		penMissile->m_pMyEffectGroup = StartEffectGroup(szMoveEffectName
			, &penMissile->en_pmiModelInstance->m_tmSkaTagManager, _pTimer->GetLerpedCurrentTick());
	}
}

void ShotConnect(CEntity *penShoter, CEntity *penTarget, FLOAT fWaitTime
				 , const char *szHitEffectName, const char *szConnectEffectName)
{
	//입력 조건 검사.
	ASSERT(penShoter != NULL && penShoter->en_pmiModelInstance != NULL);
	ASSERT(penTarget != NULL && penTarget->en_pmiModelInstance != NULL);
	ASSERT(szHitEffectName != NULL && szConnectEffectName != NULL);
	if(!(penShoter != NULL && penShoter->en_pmiModelInstance != NULL)) return;
	if(!(penTarget != NULL && penTarget->en_pmiModelInstance != NULL)) return;
	if(!(szHitEffectName != NULL && szConnectEffectName != NULL)) return;

	//missile 생성.
	CPlacement3D plNew;
	FLOAT3D vSourcePos = penShoter->GetPlacement().pl_PositionVector;
	plNew.pl_PositionVector = (vSourcePos + penTarget->GetPlacement().pl_PositionVector) * 0.5f;
	FLOAT3D vDir = vSourcePos - plNew.pl_PositionVector;
	FLOAT fLen = vDir.Length();
	vDir /= fLen;
	fLen *= 2;
	plNew.pl_OrientationAngle = GetEulerAngleFromDir(vDir);
	plNew.pl_PositionVector(2) += 1.0f;//이걸 안하면 바닥에 붙어서 이펙트가 나옴.

	CMissile *penMissile = (CMissile *)penShoter->en_pwoWorld->CreateEntity_t(plNew, "classes\\missile.ecl");

	//missile 정보 세팅.
	penMissile->m_epSource = penShoter;
	penMissile->m_epTarget = penTarget;	//target entity
	penMissile->m_strHitEffect = szHitEffectName;
	penMissile->m_fAfterDelay = fWaitTime;
	penMissile->m_eMissileType = MLT_CONNECT;
	penMissile->m_pMyEffectGroup = NULL;

	penMissile->Initialize();
	penMissile->m_pMyEffectGroup = NULL;

	penMissile->m_ulTargetID = penMissile->en_ulID;

	//Tag 및 Effect 관련 세팅
	if(penMissile->en_pmiModelInstance != NULL)
	{
		penMissile->en_pmiModelInstance->RefreshTagManager();
		penMissile->en_pmiModelInstance->m_tmSkaTagManager.SetOwner(penMissile);
		penMissile->m_pMyEffectGroup = StartEffectGroup(szConnectEffectName
			, &penMissile->en_pmiModelInstance->m_tmSkaTagManager, _pTimer->GetLerpedCurrentTick());

		if(penMissile->m_pMyEffectGroup)
		{
			for(INDEX i=0; i<penMissile->m_pMyEffectGroup->GetEffectKeyVector().size(); ++i)
			{
				CEffect *pEffect = penMissile->m_pMyEffectGroup->GetEffectKeyVector()[i].m_pCreatedEffect;
				if(pEffect != NULL && pEffect->GetType() == ET_MDL)
				{
					FLOAT3D vNewStretch = ((CMdlEffect*)pEffect)->GetStretch();
					vNewStretch(2) = fLen;
					((CMdlEffect*)pEffect)->SetStretch(vNewStretch);
				}
			}
		}
	}
}


void CMissile::SetDefaultProperties(void) {
  m_bInit = FALSE ;
  m_eMissileType = MLT_NORMALARROW ;
  m_bEntityTarget = TRUE ;
  m_epTarget = NULL;
  m_epSource = NULL;
  m_vTargetPos = FLOAT3D(0 , 0 , 0);
  m_fMoveSpeed = 1.0f;
  m_fBeforeDelay = 0.0f;
  m_fAfterDelay = 3.5f;
  m_strHitEffect = "";
  m_strMoveEffect = "";
  m_fnModel = CTFILENAME("");
  m_fHorizonalOffset = 0.0f;
  m_fVerticalOffset = 0.0f;
  m_soSound.SetOwner(this);
m_soSound.Stop(FALSE);
  m_bCritical = FALSE ;
  m_aAngleSpeed = 0.0f;
  m_bDirectTag = TRUE ;
  m_iFireObjectType = 0;
  CRationalEntity::SetDefaultProperties();
}
  
#line 430 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
void CMissile::RemakeSplinePath() 
#line 431 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 432 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(! m_bEntityTarget ){return ;}
#line 433 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_bNoPeak )
#line 434 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 435 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
GetSpline  () . RemoveSample  (1);
#line 436 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 437 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else 
#line 438 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 439 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
GetSpline  () . RemoveSample  (2);
#line 440 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 447 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vTargetPos  = m_epTarget  -> en_plPlacement  . pl_PositionVector ;
#line 448 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
vTargetPos  (2) += m_vTargetCenterPos  (2);
#line 449 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
GetSpline  () . AddSample  (1.0f , vTargetPos );
#line 450 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
GetSpline  () . Prepare  ();
#line 451 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
  
#line 453 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
void CMissile::InflictDirectDamage(CEntity * penToDamage,CEntity * penInflictor,enum DamageType dmtType,
#line 454 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT fDamageAmmount,const FLOAT3D & vHitPoint,const FLOAT3D & vDirection) 
#line 455 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 456 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_bCritical )
#line 457 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 458 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
PlaySound  (m_soSound  , SOUND_BOW_CRITICAL  , SOF_3D  | SOF_VOLUMETRIC );
#line 459 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_bCritical  = FALSE ;
#line 460 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 461 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else 
#line 462 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 463 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
PlaySound  (m_soSound  , SOUND_BOW_BLOW  , SOF_3D  | SOF_VOLUMETRIC );
#line 464 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 466 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
fDamageAmmount  = 0;
#line 467 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(penToDamage )
#line 468 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 469 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(! (penToDamage  -> GetFlags  () & ENF_ALIVE )){return ;}
#line 470 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
_pUIMgr  -> ShowDamage  (penToDamage  -> en_ulID );
#line 471 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
INDEX preHealth  , curHealth ;
#line 472 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
preHealth  = ((CUnit  *) penToDamage ) -> m_nPreHealth ;
#line 473 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
curHealth  = ((CUnit  *) penToDamage ) -> m_nCurrentHealth ;
#line 475 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(preHealth  != - 1 && curHealth  > preHealth )
#line 476 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 477 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
fDamageAmmount  = 1;
#line 478 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
((CUnit  *) penToDamage ) -> m_nCurrentHealth  = ((CUnit  *) penToDamage ) -> m_nPreHealth ;
#line 480 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 481 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else fDamageAmmount  = 0;
#line 482 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(penToDamage  == _pNetwork  -> _TargetInfo  . pen_pEntity )
#line 483 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 484 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(penToDamage  -> IsCharacter  ())
#line 485 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 486 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
penToDamage  -> UpdateTargetInfo  (((CUnit  *) penToDamage ) -> m_nMaxiHealth  , ((CUnit  *) penToDamage ) -> m_nCurrentHealth  , ((CCharacter  *) penToDamage ) -> m_nPkMode  , ((CCharacter  *) penToDamage ) -> m_nPkState  , ((CCharacter  *) penToDamage ) -> m_nLegit );
#line 487 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 488 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else 
#line 489 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 490 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
penToDamage  -> UpdateTargetInfo  (((CUnit  *) penToDamage ) -> m_nMaxiHealth  , ((CUnit  *) penToDamage ) -> m_nCurrentHealth );
#line 491 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 492 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 494 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(((CUnit  *) penToDamage ) -> m_nCurrentHealth  == 0)
#line 495 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 496 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(penToDamage  == _pNetwork  -> _TargetInfo  . pen_pEntity )
#line 497 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 498 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
_pNetwork  -> _TargetInfo  . Init  ();
#line 499 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 500 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 501 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 506 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(_pNetwork  -> m_bSingleMode )
#line 507 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 510 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(g_slZone  == EXTREAM_SINGLEDUNGEON  && ! ((CEnemy  *) penToDamage ) -> m_bBoss )
#line 511 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 512 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CEntity  :: InflictDirectDamage  (penToDamage  , penInflictor  , DMT_EXPLOSION  , 30.0f , vHitPoint  , vDirection );
#line 513 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 514 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else 
#line 515 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 516 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CEntity  :: InflictDirectDamage  (penToDamage  , penInflictor  , DMT_EXPLOSION  , fDamageAmmount  , vHitPoint  , vDirection );
#line 517 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 518 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 519 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else 
#line 520 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 521 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CEntity  :: InflictDirectDamage  (penToDamage  , penInflictor  , dmtType  , fDamageAmmount  , vHitPoint  , vDirection );
#line 522 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 524 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(penToDamage  && penToDamage  -> IsEnemy  ())
#line 525 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 526 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
const INDEX iMobIndex  = ((CEnemy  *) penToDamage ) -> m_nMobDBIndex ;
#line 528 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(iMobIndex  == LORD_SYMBOL_INDEX )
#line 529 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 530 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CMobData  & MD  = _pNetwork  -> GetMobData  (iMobIndex );
#line 531 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
INDEX iCurHealth  = ((CUnit  *) ((CEntity  *) penToDamage )) -> m_nCurrentHealth ;
#line 532 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
static INDEX iType  = 0;
#line 533 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
float  fMaxHealth  = MD  . GetHealth  ();
#line 534 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(iCurHealth  <= fMaxHealth  * 0.25f)
#line 535 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 536 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(iType  != 1)
#line 537 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 538 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
iType  = 1;
#line 539 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
penToDamage  -> SetSkaModel  ("data\\npc\\Gguard\\sword04.smc");
#line 540 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
penToDamage  -> GetModelInstance  () -> RefreshTagManager  ();
#line 541 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 542 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 543 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else if(iCurHealth  <= fMaxHealth  * 0.50f)
#line 544 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 545 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(iType  != 2)
#line 546 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 547 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
iType  = 2;
#line 548 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
penToDamage  -> SetSkaModel  ("data\\npc\\Gguard\\sword03.smc");
#line 549 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
penToDamage  -> GetModelInstance  () -> RefreshTagManager  ();
#line 550 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 551 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 552 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else if(iCurHealth  <= fMaxHealth  * 0.75f)
#line 553 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 554 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(iType  != 3)
#line 555 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 556 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
iType  = 3;
#line 557 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
penToDamage  -> SetSkaModel  ("data\\npc\\Gguard\\sword02.smc");
#line 558 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
penToDamage  -> GetModelInstance  () -> RefreshTagManager  ();
#line 559 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 560 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 561 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else 
#line 562 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 563 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(iType  != 0)
#line 564 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 565 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
iType  = 0;
#line 566 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
penToDamage  -> SetSkaModel  (MD  . GetMobSmcFileName  ());
#line 567 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
penToDamage  -> GetModelInstance  () -> RefreshTagManager  ();
#line 568 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 569 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 571 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 572 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 574 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(penToDamage  -> IsEnemy  ())
#line 575 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 576 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(((CUnit  *) ((CEntity  *) penToDamage )) -> m_nCurrentHealth  <= 0)
#line 577 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 578 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CMobData  & MD  = _pNetwork  -> GetMobData  (((CEnemy  *) (CEntity  *) penToDamage ) -> m_nMobDBIndex );
#line 579 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(! MD  . IsCastleTower  ())
#line 580 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 581 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
((CUnit  *) ((CEntity  *) penToDamage )) -> DeathNow  ();
#line 582 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 583 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else 
#line 584 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 587 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(MD  . GetMobIndex  () >= 352 && MD  . GetMobIndex  () <= 399)
#line 588 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 589 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
((CUnit  *) ((CEntity  *) penToDamage )) -> DeathNow  ();
#line 590 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 591 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else 
#line 592 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 593 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
((CUnit  *) ((CEntity  *) penToDamage )) -> SetFlagOff  (ENF_ALIVE );
#line 594 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 595 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 596 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 597 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 598 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else if(penToDamage )
#line 599 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 600 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(((CUnit  *) ((CEntity  *) penToDamage )) -> m_nCurrentHealth  <= 0)
#line 601 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 602 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
((CUnit  *) ((CEntity  *) penToDamage )) -> DeathNow  ();
#line 603 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 604 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 605 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
  
#line 607 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
void CMissile::HitTarget() 
#line 608 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 609 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_iFireObjectType  == CSkill  :: MT_DASH )
#line 610 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 611 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_epSource  -> GetNetworkType  () == MSG_CHAR_PC  && 
#line 612 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_epSource  -> GetNetworkID  () == _pNetwork  -> MyCharacterInfo  . index  && ! m_bMoveFail )
#line 613 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 614 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CPlacement3D plSource  = GetPlacement  ();
#line 616 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_epSource  -> SetPlacement  (plSource );
#line 618 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
_pNetwork  -> SendSkillMessage  (401 , m_epTarget  , m_epTarget  -> GetNetworkID  () , TRUE  , 1);
#line 619 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 621 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_bMoveFail )
#line 622 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 623 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_epSource  -> SetPlacement  (GetPlacement  ());
#line 624 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 626 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOATmatrix3D matrix ;
#line 627 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
MakeRotationMatrixFast  (matrix  , this  -> en_plPlacement  . pl_OrientationAngle );
#line 628 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vDir  (0 , 1 , 0);
#line 629 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
RotateVector  (vDir  , matrix );
#line 630 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vAxisY  (0 , 1 , 0);
#line 631 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT angle  = acos  (vDir  % vAxisY );
#line 632 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D axis  = vAxisY  * vDir ;
#line 633 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
axis  . Normalize  ();
#line 634 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOATquat3D quat ;
#line 635 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
quat  . FromAxisAngle  (axis  , angle );
#line 636 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
StartEffectGroup  (m_strHitEffect  , _pTimer  -> GetLerpedCurrentTick  () , this  -> en_plPlacement  . pl_PositionVector  , quat );
#line 637 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 638 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else if((CEntity  *) m_epTarget  != NULL )
#line 639 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 640 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOATmatrix3D matrix ;
#line 641 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
MakeRotationMatrixFast  (matrix  , this  -> en_plPlacement  . pl_OrientationAngle );
#line 642 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vDir  (0 , 1 , 0);
#line 643 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
RotateVector  (vDir  , matrix );
#line 644 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
this  -> InflictDirectDamage  (m_epTarget  , this  , DMT_NONE  , 1 , this  -> en_plPlacement  . pl_PositionVector  , vDir );
#line 645 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vAxisY  (0 , 1 , 0);
#line 646 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT angle  = acos  (vDir  % vAxisY );
#line 647 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D axis  = vAxisY  * vDir ;
#line 648 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
axis  . Normalize  ();
#line 649 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOATquat3D quat ;
#line 650 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
quat  . FromAxisAngle  (axis  , angle );
#line 651 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
StartEffectGroup  (m_strHitEffect  , _pTimer  -> GetLerpedCurrentTick  () , this  -> en_plPlacement  . pl_PositionVector  , quat );
#line 652 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 653 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else 
#line 654 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 655 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vAxisY  (0 , 1 , 0);
#line 656 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vDir  = (m_vInitPos  - m_vTargetPos ) . SafeNormalize  ();
#line 657 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT angle  = acos  (vDir  % vAxisY );
#line 658 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D axis  = vAxisY  * vDir ;
#line 659 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOATquat3D quat ;
#line 660 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
quat  . FromAxisAngle  (axis  , angle );
#line 661 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
StartEffectGroup  (m_strHitEffect  , _pTimer  -> GetLerpedCurrentTick  () , this  -> en_plPlacement  . pl_PositionVector  , quat );
#line 662 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 663 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
  
#line 664 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D CMissile::GetBoundingSphereInfo(CEntity * pen) 
#line 665 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 666 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(pen  == NULL ){return FLOAT3D (1 , 0 , 1);}
#line 668 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(pen  -> GetRenderType  () == RT_SKAMODEL  || pen  -> GetRenderType  () == RT_SKAEDITORMODEL )
#line 669 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 670 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(pen  -> en_pmiModelInstance  != NULL )
#line 671 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 672 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOATaabbox3D bbox ;
#line 673 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
pen  -> en_pmiModelInstance  -> GetCurrentColisionBox  (bbox );
#line 674 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
pen  -> en_pmiModelInstance  -> mi_vStretch ;
#line 675 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vLength  = bbox  . Max  () - bbox  . Min  ();
#line 676 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
vLength  (2) = 0;
#line 677 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT fStretchXY  = Max  (pen  -> en_pmiModelInstance  -> mi_vStretch  (1) , pen  -> en_pmiModelInstance  -> mi_vStretch  (3));
#line 678 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
return FLOAT3D (vLength  . Length  () * 0.40f * fStretchXY  
#line 679 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
, bbox  . Min  () (2) * pen  -> en_pmiModelInstance  -> mi_vStretch  (2) 
#line 680 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
, bbox  . Max  () (2) * pen  -> en_pmiModelInstance  -> mi_vStretch  (2));
#line 681 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 682 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 683 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else if(pen  -> GetRenderType  () == RT_MODEL  || pen  -> GetRenderType  () == RT_EDITORMODEL )
#line 684 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 685 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(pen  -> en_pmoModelObject  != NULL )
#line 686 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 687 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOATaabbox3D bbox ;
#line 688 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
pen  -> en_pmoModelObject  -> GetCurrentFrameBBox  (bbox );
#line 689 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vLength  = bbox  . Max  () - bbox  . Min  ();
#line 690 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
vLength  (2) = 0;
#line 691 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
return FLOAT3D (vLength  . Length  () * 0.40f , bbox  . Min  () (2) , bbox  . Max  () (2));
#line 692 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT fStretchXY  = Max  (pen  -> en_pmoModelObject  -> mo_Stretch  (1) , pen  -> en_pmoModelObject  -> mo_Stretch  (3));
#line 693 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
return FLOAT3D (vLength  . Length  () * 0.40f * fStretchXY  
#line 694 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
, bbox  . Min  () (2) * pen  -> en_pmoModelObject  -> mo_Stretch  (2) 
#line 695 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
, bbox  . Max  () (2) * pen  -> en_pmoModelObject  -> mo_Stretch  (2));
#line 696 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 697 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 698 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
return FLOAT3D (1.0f , 0.0f , 1.0f);
#line 699 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
  
#line 700 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
void CMissile::CalcPalacementOnPath(FLOAT curRatio,FLOAT oldRatio,FLOAT processedTime,CPlacement3D & newPlace) 
#line 701 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 702 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vCurrentPos  = GetSpline  () . Value  (curRatio );
#line 703 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vCurrentDir  = vCurrentPos  - GetSpline  () . Value  (oldRatio );
#line 705 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_iFireObjectType  == CSkill  :: MT_DASH )
#line 706 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 707 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fLeftDistance  += vCurrentDir  . Length  ();
#line 709 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vSource  = GetSpline  () . Value  (oldRatio );
#line 710 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vTarget  = vCurrentPos ;
#line 711 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CCastRay  crRay  (this  , vSource  , vTarget );
#line 712 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
crRay  . cr_ttHitModels  = CCastRay  :: TT_NONE ;
#line 713 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
crRay  . cr_bHitTranslucentPortals  = TRUE ;
#line 714 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
crRay  . cr_bPhysical  = TRUE ;
#line 715 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
GetWorld  () -> CastRay  (crRay );
#line 716 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(crRay  . cr_penHit  != NULL )
#line 717 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 718 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_bMoveFail  = TRUE ;
#line 719 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 720 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 722 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
ANGLE3D aCurrentRot ;
#line 723 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_aAngleSpeed  != 0.0f)
#line 724 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 725 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOATquat3D quatCurrent ;
#line 727 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
quatCurrent  . FromAxisAngle  (vCurrentDir  , RadAngle  (m_aAngleSpeed  * processedTime ));
#line 729 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
aCurrentRot  = GetEulerAngleFromQuaternion  (quatCurrent );
#line 730 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 731 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else 
#line 732 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 733 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
aCurrentRot  = GetEulerAngleFromDir  (vCurrentDir );
#line 734 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 736 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
newPlace  . pl_OrientationAngle  = aCurrentRot ;
#line 737 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
newPlace  . pl_PositionVector  = vCurrentPos ;
#line 738 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
  
#line 739 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
BOOL CMissile::PathMove(FLOAT fDeltaTime) 
#line 740 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 742 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
RemakeSplinePath  ();
#line 744 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CPlacement3D plNew ;
#line 745 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT fOldRatio  = m_fRatio ;
#line 746 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fRatio  += m_fTimeRatio  * fDeltaTime ;
#line 747 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fTimeFromStart  += fDeltaTime ;
#line 748 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CalcPalacementOnPath  (m_fRatio  , fOldRatio  - m_fTimeRatio  * 0.001f , m_fTimeFromStart  , plNew );
#line 750 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_iFireObjectType  == CSkill  :: MT_DASH )
#line 751 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 760 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_bMoveFail )
#line 761 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 762 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
return TRUE ;
#line 763 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 766 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_fRatio  >= 0.8f)
#line 767 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 768 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetPlacement  (plNew );
#line 769 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
return TRUE ;
#line 770 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 771 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 773 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetPlacement  (plNew );
#line 776 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_fRatio  >= 1.0f){return TRUE ;}
#line 777 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else {return FALSE ;}
#line 778 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
BOOL CMissile::
#line 780 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
PreBehavior(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT STATE_CMissile_PreBehavior
  ASSERTMSG(__eeInput.ee_slEvent==EVENTCODE_EVoid, "CMissile::PreBehavior expects 'EVoid' as input!");  const EVoid &e = (const EVoid &)__eeInput;
#line 782 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetTimerAfter(0.01f);
Jump(STATE_CURRENT, 0x03ed0001, FALSE, EBegin());return TRUE;}BOOL CMissile::H0x03ed0001_PreBehavior_01(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0001
switch(__eeInput.ee_slEvent) {case EVENTCODE_EBegin: return TRUE;case EVENTCODE_ETimer: Jump(STATE_CURRENT,0x03ed0002, FALSE, EInternal()); return TRUE;default: return FALSE; }}BOOL CMissile::H0x03ed0002_PreBehavior_02(const CEntityEvent &__eeInput){
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0002
;
#line 783 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(! m_bInit )
#line 784 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 785 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fLastTime  = _pTimer  -> GetHighPrecisionTimer  () . GetSeconds  ();
#line 786 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_bInit  = TRUE ;
#line 787 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 789 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_fBeforeDelay  <= _pTimer  -> TickQuantum ){m_fBeforeDelay  = _pTimer  -> TickQuantum  * 0.01f;}
#line 790 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetTimerAfter(m_fBeforeDelay );
Jump(STATE_CURRENT, 0x03ed0003, FALSE, EBegin());return TRUE;}BOOL CMissile::H0x03ed0003_PreBehavior_03(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0003
switch(__eeInput.ee_slEvent) {case EVENTCODE_EBegin: return TRUE;case EVENTCODE_ETimer: Jump(STATE_CURRENT,0x03ed0004, FALSE, EInternal()); return TRUE;default: return FALSE; }}BOOL CMissile::H0x03ed0004_PreBehavior_04(const CEntityEvent &__eeInput){
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0004
;
#line 792 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Jump(STATE_CURRENT, STATE_CMissile_DoBehavior, TRUE, EVoid());return TRUE;
#line 794 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Return(STATE_CURRENT,EVoid());
#line 794 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
return TRUE; ASSERT(FALSE); return TRUE;};BOOL CMissile::
#line 796 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
PostBehavior(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT STATE_CMissile_PostBehavior
  ASSERTMSG(__eeInput.ee_slEvent==EVENTCODE_EVoid, "CMissile::PostBehavior expects 'EVoid' as input!");  const EVoid &e = (const EVoid &)__eeInput;
#line 798 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetTimerAfter(0.001f);
Jump(STATE_CURRENT, 0x03ed0006, FALSE, EBegin());return TRUE;}BOOL CMissile::H0x03ed0006_PostBehavior_01(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0006
switch(__eeInput.ee_slEvent) {case EVENTCODE_EBegin: return TRUE;case EVENTCODE_ETimer: Jump(STATE_CURRENT,0x03ed0007, FALSE, EInternal()); return TRUE;default: return FALSE; }}BOOL CMissile::H0x03ed0007_PostBehavior_02(const CEntityEvent &__eeInput){
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0007
;
#line 801 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_pMyEffectGroup  != NULL  && CEffectGroupManager  :: Instance  () . IsValidCreated  (m_pMyEffectGroup ))
#line 802 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 803 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_pMyEffectGroup  -> Stop  (0);
#line 804 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 805 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else m_pMyEffectGroup  = NULL ;
#line 808 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_epTarget  . ep_pen  != NULL  && m_epTarget  -> en_pmiModelInstance  != NULL )
#line 809 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 810 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_eMissileType  == MLT_NORMALARROW  
#line 811 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
&& ((CEnemy  *) (CEntity  *) m_epTarget ) -> m_nMobDBIndex  != 82)
#line 812 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 814 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CSkaTag  * pSkaTag  = NULL ;
#line 815 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
INDEX temp  = m_epTarget  -> en_pmiModelInstance  -> m_tmSkaTagManager  . GetTempValue  ();
#line 816 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
for(m_iIndex  = 0;m_iIndex  < 31;++ m_iIndex ){if(! (temp  & (0x00000001 << m_iIndex ))){break ;}}
#line 817 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_iIndex  != 31)
#line 818 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 819 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_strHitTag  . PrintF  ("TEMP%x" , 0x00000001 << m_iIndex );
#line 820 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_epTarget  -> en_pmiModelInstance  -> m_tmSkaTagManager  . SetTempValue  (temp  | (0x00000001 << m_iIndex ));
#line 821 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
pSkaTag  = (CSkaTag  *) m_epTarget  -> en_pmiModelInstance  -> m_tmSkaTagManager  . Find  (m_strHitTag  . str_String );
#line 822 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(pSkaTag  == NULL )
#line 823 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 830 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vTarget  = m_epTarget  -> en_plPlacement  . pl_PositionVector ;
#line 831 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
vTarget  (2) += m_vTargetCenterPos  (2);
#line 832 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vDist  = vTarget  - m_vInitPos ;
#line 833 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT dist  = vDist  . Length  ();
#line 834 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
INDEX iBoneID ;
#line 835 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
MeshLOD  * pmlod  = NULL ;
#line 836 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
pSkaTag  = new  CSkaTag ;
#line 837 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT fDist  = RM_TestRayCastHit  (
#line 838 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
* m_epTarget  -> en_pmiModelInstance  
#line 839 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
, m_epTarget  -> en_mRotation  
#line 840 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
, m_epTarget  -> en_plPlacement  . pl_PositionVector  
#line 841 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
, m_vInitPos  
#line 842 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
, vTarget  
#line 843 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
, dist  
#line 844 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
, & iBoneID  
#line 845 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
, pSkaTag );
#line 846 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(fDist  == 1e6)
#line 847 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 848 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
delete  pSkaTag ;
#line 849 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
pSkaTag  = NULL ;
#line 850 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 851 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else 
#line 852 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 853 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
pSkaTag  -> SetName  (m_strHitTag  . str_String );
#line 854 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOATquat3D quatDir  , quatEn  , quatEnMi ;
#line 855 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
quatEn  . FromEuler  (m_epTarget  -> en_plPlacement  . pl_OrientationAngle );
#line 856 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
quatEnMi  = quatEn  . Inv  () * m_epTarget  -> en_pmiModelInstance  -> mi_qvOffset  . qRot  . Inv  ();
#line 857 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
quatDir  . FromEuler  (GetEulerAngleFromDir  (vDist  . SafeNormalize  ()));
#line 859 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
pSkaTag  -> SetOffsetRot  (quatEnMi  * quatDir );
#line 861 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D pos  = pSkaTag  -> GetOffsetPos  () - m_epTarget  -> en_plPlacement  . pl_PositionVector  - m_epTarget  -> en_pmiModelInstance  -> mi_qvOffset  . vPos ;
#line 862 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
pos  = VectorRotate  (pos  , quatEnMi );
#line 863 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
pSkaTag  -> SetOffsetPos  (pos );
#line 865 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_epTarget  -> en_pmiModelInstance  -> m_tmSkaTagManager  . RegisterNoCopy  (pSkaTag );
#line 866 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 867 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 868 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 869 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(pSkaTag  != NULL )
#line 870 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 871 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CEffectGroup  * pEG  = StartEffectGroup  (
#line 872 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
"Normal Arrow" 
#line 873 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
, _pTimer  -> GetLerpedCurrentTick  () 
#line 874 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
, ptr_tag  ((CTag  *) pSkaTag ));
#line 875 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(pEG ){pEG  -> Stop  (m_fAfterDelay );}
#line 876 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
this  -> SetFlagOn  (ENF_HIDDEN );
#line 877 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 878 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 879 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else if(m_eMissileType  == MLT_GOWAITBACK )
#line 880 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 881 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 882 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 884 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_fAfterDelay  <= _pTimer  -> TickQuantum ){m_fAfterDelay  = _pTimer  -> TickQuantum  * 0.01f;}
#line 885 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetTimerAfter(m_fAfterDelay );
Jump(STATE_CURRENT, 0x03ed0008, FALSE, EBegin());return TRUE;}BOOL CMissile::H0x03ed0008_PostBehavior_03(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0008
switch(__eeInput.ee_slEvent) {case EVENTCODE_EBegin: return TRUE;case EVENTCODE_ETimer: Jump(STATE_CURRENT,0x03ed0009, FALSE, EInternal()); return TRUE;default: return FALSE; }}BOOL CMissile::H0x03ed0009_PostBehavior_04(const CEntityEvent &__eeInput){
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0009
;
#line 887 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_eMissileType  == MLT_GOWAITBACK  && m_epSource  != NULL  && m_epSource  -> en_pmiModelInstance  != NULL )
#line 888 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 889 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_bReached  = FALSE ;
#line 890 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_bReached2  = FALSE ;
#line 891 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fRatio  = 0.0f;
#line 892 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fTimeFromStart  = 0.0f;
#line 893 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_bNoPeak  = TRUE ;
#line 894 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_eMissileType  = MLT_SOMETHING ;
#line 895 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fAfterDelay  = 0.0f;
#line 896 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_strHitEffect  += "\'";
#line 898 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_vInitPos  = m_epTarget  -> GetPlacement  () . pl_PositionVector ;
#line 899 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vDist  = m_vInitPos  - m_epSource  -> GetPlacement  () . pl_PositionVector ;
#line 900 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT fDist  = vDist  . Length  ();
#line 901 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fTimeRatio  = m_fMoveSpeed  / fDist ;
#line 902 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
GetSpline  () . Clear  ();
#line 903 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
GetSpline  () . AddSample  (0.0f , m_vInitPos );
#line 904 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
GetSpline  () . AddSample  (1.0f , m_epSource  -> GetPlacement  () . pl_PositionVector );
#line 905 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_epTarget  = m_epSource ;
#line 906 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
GetSpline  () . Prepare  ();
#line 907 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
RemakeSplinePath  ();
#line 908 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CPlacement3D plNew ;
#line 909 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fRatio  += m_fTimeRatio  * 0.001f;
#line 910 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CalcPalacementOnPath  (m_fRatio  , 0 , 0.001f , plNew );
#line 911 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetPlacement  (plNew );
#line 912 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_strMoveEffect  += "\'";
#line 913 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_pMyEffectGroup  = StartEffectGroup  (m_strMoveEffect  , & GetModelInstance  () -> m_tmSkaTagManager  , _pTimer  -> GetLerpedCurrentTick  ());
#line 914 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_bInit  = FALSE ;
#line 915 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Jump(STATE_CURRENT, STATE_CMissile_PreBehavior, TRUE, EVoid());return TRUE;
#line 916 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 918 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
this  -> SetFlagOn  (ENF_HIDDEN );
#line 919 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_strHitTag  != "" && m_epTarget  -> en_RenderType  != RT_NONE  && m_epTarget  -> en_pmiModelInstance )
#line 920 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 921 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_epTarget  -> en_pmiModelInstance  -> m_tmSkaTagManager  . Unregister  (m_strHitTag  . str_String );
#line 922 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_epTarget  -> en_pmiModelInstance  -> m_tmSkaTagManager  . SetTempValue  (
#line 923 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_epTarget  -> en_pmiModelInstance  -> m_tmSkaTagManager  . GetTempValue  () & 
#line 924 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
(~ (0x00000001 << m_iIndex )));
#line 925 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 927 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_epSource  != NULL )
#line 928 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 929 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_epSource  -> GetNetworkID  () == _pNetwork  -> MyCharacterInfo  . index )
#line 930 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 931 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_epSource  -> IsFlagOn  (ENF_INVISIBLE ))
#line 932 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 933 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_epSource  -> SetFlagOff  (ENF_INVISIBLE );
#line 934 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 935 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 936 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 938 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_bInit  = FALSE ;
#line 939 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetFlagOff  (ENF_ALIVE );
#line 940 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetFlagOn  (ENF_CLIENTHANDLING );
#line 941 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
delete  m_pssPath ;
#line 942 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_pssPath  = NULL ;
#line 943 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Destroy  (FALSE );
#line 945 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Return(STATE_CURRENT,EVoid());
#line 945 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
return TRUE; ASSERT(FALSE); return TRUE;};BOOL CMissile::
#line 947 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
DoBehavior(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT STATE_CMissile_DoBehavior
  ASSERTMSG(__eeInput.ee_slEvent==EVENTCODE_EVoid, "CMissile::DoBehavior expects 'EVoid' as input!");  const EVoid &e = (const EVoid &)__eeInput;
#line 949 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Jump(STATE_CURRENT,0x03ed000d, FALSE, EInternal());return TRUE;}BOOL CMissile::H0x03ed000d_DoBehavior_03(const CEntityEvent &__eeInput)
#line 950 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed000d
if(!(! m_bReached )){ Jump(STATE_CURRENT,0x03ed000e, FALSE, EInternal());return TRUE;}
#line 951 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetTimerAfter(0.01f);
Jump(STATE_CURRENT, 0x03ed000b, FALSE, EBegin());return TRUE;}BOOL CMissile::H0x03ed000b_DoBehavior_01(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed000b
switch(__eeInput.ee_slEvent) {case EVENTCODE_EBegin: return TRUE;case EVENTCODE_ETimer: Jump(STATE_CURRENT,0x03ed000c, FALSE, EInternal()); return TRUE;default: return FALSE; }}BOOL CMissile::H0x03ed000c_DoBehavior_02(const CEntityEvent &__eeInput){
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed000c
;
#line 952 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_bEntityTarget  && m_epTarget  . ep_pen  == NULL )
#line 953 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 954 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Jump(STATE_CURRENT, STATE_CMissile_PostBehavior, TRUE, EVoid());return TRUE;
#line 955 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 957 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT fCurrent  = _pTimer  -> GetHighPrecisionTimer  () . GetSeconds  ();
#line 958 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fDeltaTime  = fCurrent  - m_fLastTime ;
#line 959 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fLastTime  = fCurrent ;
#line 961 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(! m_bReached )
#line 962 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 963 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_bReached  = PathMove  (m_fDeltaTime );
#line 964 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}Jump(STATE_CURRENT,0x03ed000d, FALSE, EInternal());return TRUE;
#line 969 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}BOOL CMissile::H0x03ed000e_DoBehavior_04(const CEntityEvent &__eeInput) {
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed000e

#line 971 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
HitTarget  ();
#line 973 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Jump(STATE_CURRENT, STATE_CMissile_PostBehavior, TRUE, EVoid());return TRUE;
#line 975 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Return(STATE_CURRENT,EVoid());
#line 975 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
return TRUE; ASSERT(FALSE); return TRUE;};BOOL CMissile::
#line 977 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Connect(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT STATE_CMissile_Connect
  ASSERTMSG(__eeInput.ee_slEvent==EVENTCODE_EVoid, "CMissile::Connect expects 'EVoid' as input!");  const EVoid &e = (const EVoid &)__eeInput;
#line 979 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetTimerAfter(0.1f);
Jump(STATE_CURRENT, 0x03ed0010, FALSE, EBegin());return TRUE;}BOOL CMissile::H0x03ed0010_Connect_01(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0010
switch(__eeInput.ee_slEvent) {case EVENTCODE_EBegin: return TRUE;case EVENTCODE_ETimer: Jump(STATE_CURRENT,0x03ed0011, FALSE, EInternal()); return TRUE;default: return FALSE; }}BOOL CMissile::H0x03ed0011_Connect_02(const CEntityEvent &__eeInput){
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0011
;
#line 981 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fLastTime  = _pTimer  -> GetLerpedCurrentTick  ();
#line 982 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
StartEffectGroup  (m_strHitEffect  , & m_epTarget  -> GetModelInstance  () -> m_tmSkaTagManager  , m_fLastTime );
#line 984 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetTimerAfter(0.1f);
Jump(STATE_CURRENT, 0x03ed0012, FALSE, EBegin());return TRUE;}BOOL CMissile::H0x03ed0012_Connect_03(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0012
switch(__eeInput.ee_slEvent) {case EVENTCODE_EBegin: return TRUE;case EVENTCODE_ETimer: Jump(STATE_CURRENT,0x03ed0013, FALSE, EInternal()); return TRUE;default: return FALSE; }}BOOL CMissile::H0x03ed0013_Connect_04(const CEntityEvent &__eeInput){
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0013
;
#line 985 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Jump(STATE_CURRENT,0x03ed0016, FALSE, EInternal());return TRUE;}BOOL CMissile::H0x03ed0016_Connect_07(const CEntityEvent &__eeInput)
#line 986 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0016
if(!(_pTimer  -> GetLerpedCurrentTick  () - m_fLastTime  < m_fAfterDelay )){ Jump(STATE_CURRENT,0x03ed0017, FALSE, EInternal());return TRUE;}
#line 987 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CPlacement3D plNew ;
#line 988 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vSourcePos  = m_epSource  -> GetPlacement  () . pl_PositionVector ;
#line 989 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
plNew  . pl_PositionVector  = (vSourcePos  + m_epTarget  -> GetPlacement  () . pl_PositionVector ) * 0.5f;
#line 990 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vDir  = vSourcePos  - plNew  . pl_PositionVector ;
#line 991 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT fLen  = vDir  . Length  ();
#line 992 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
vDir  /= fLen ;
#line 993 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
fLen  *= 2;
#line 994 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
plNew  . pl_OrientationAngle  = GetEulerAngleFromDir  (vDir );
#line 995 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
plNew  . pl_PositionVector  (2) += 1.0f;
#line 996 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetPlacement  (plNew );
#line 998 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_pMyEffectGroup )
#line 999 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1000 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
for(INDEX i  = 0;i  < m_pMyEffectGroup  -> GetEffectKeyVector  () . size  ();++ i )
#line 1001 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1002 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CEffect  * pEffect  = m_pMyEffectGroup  -> GetEffectKeyVector  () [ i  ] . m_pCreatedEffect ;
#line 1003 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(pEffect  != NULL  && pEffect  -> GetType  () == ET_MDL )
#line 1004 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1005 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vNewStretch  = ((CMdlEffect  *) pEffect ) -> GetStretch  ();
#line 1006 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
vNewStretch  (2) = fLen ;
#line 1007 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
((CMdlEffect  *) pEffect ) -> SetStretch  (vNewStretch );
#line 1008 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1009 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1010 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1012 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetTimerAfter(0.1f);
Jump(STATE_CURRENT, 0x03ed0014, FALSE, EBegin());return TRUE;}BOOL CMissile::H0x03ed0014_Connect_05(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0014
switch(__eeInput.ee_slEvent) {case EVENTCODE_EBegin: return TRUE;case EVENTCODE_ETimer: Jump(STATE_CURRENT,0x03ed0015, FALSE, EInternal()); return TRUE;default: return FALSE; }}BOOL CMissile::H0x03ed0015_Connect_06(const CEntityEvent &__eeInput){
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0015
;Jump(STATE_CURRENT,0x03ed0016, FALSE, EInternal());return TRUE;
#line 1013 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}BOOL CMissile::H0x03ed0017_Connect_08(const CEntityEvent &__eeInput) {
ASSERT(__eeInput.ee_slEvent==EVENTCODE_EInternal);
#undef STATE_CURRENT
#define STATE_CURRENT 0x03ed0017

#line 1015 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_pMyEffectGroup )
#line 1016 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1017 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
StopEffectGroupIfValid  (m_pMyEffectGroup  , 0.1f);
#line 1018 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1019 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Destroy  (FALSE );
#line 1020 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Return(STATE_CURRENT,EVoid());
#line 1020 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
return TRUE; ASSERT(FALSE); return TRUE;};BOOL CMissile::
#line 1023 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Main(const CEntityEvent &__eeInput) {
#undef STATE_CURRENT
#define STATE_CURRENT STATE_CMissile_Main
  ASSERTMSG(__eeInput.ee_slEvent==EVENTCODE_EVoid, "CMissile::Main expects 'EVoid' as input!");  const EVoid &e = (const EVoid &)__eeInput;
#line 1025 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_bEntityTarget  && m_epTarget  . ep_pen  == NULL )
#line 1026 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1027 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
InitAsVoid  ();
#line 1028 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetFlagOff  (ENF_ALIVE );
#line 1029 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetFlagOn  (ENF_CLIENTHANDLING );
#line 1030 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Destroy  (FALSE );
#line 1031 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Return(STATE_CURRENT,EVoid());
#line 1031 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
return TRUE;
#line 1032 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1033 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
InitAsSkaModel  ();
#line 1034 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_soSound  . Set3DParameters  (30.0f , 5.0f , 1.0f , 1.0f);
#line 1037 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
try {
#line 1038 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_fnModel  . GetName  () != ""){SetSkaModel_t  (m_fnModel );}
#line 1039 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else 
#line 1040 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1041 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fnModel  = CTFileName ("data\\effect\\ska\\invisible.smc");
#line 1042 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetSkaModel_t  (m_fnModel );
#line 1043 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1044 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_eMissileType  == MLT_NORMALARROW )
#line 1045 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1046 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
en_pmiModelInstance  -> mi_qvOffset  . vPos  = FLOAT3D (0 , 0 , 0);
#line 1047 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
en_pmiModelInstance  -> mi_qvOffset  . qRot  = FLOATquat3D (1 , 0 , 0 , 0);
#line 1048 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1050 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1051 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
catch  (char  *)
#line 1052 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1053 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
ASSERTALWAYS  ("Loading Fail.");
#line 1054 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1057 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
ModelChangeNotify  ();
#line 1058 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetPhysicsFlags  (EPF_MODEL_IMMATERIAL );
#line 1059 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetCollisionFlags  (ECF_IMMATERIAL );
#line 1061 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetFlags  (GetFlags  () & ~ ENF_CLUSTERSHADOWS );
#line 1062 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(en_pmiModelInstance ){en_pmiModelInstance  -> SetCurrentColisionBoxIndex  (0);}
#line 1064 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_eMissileType  == MLT_CONNECT )
#line 1065 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1067 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_epSource  . ep_pen  == NULL )
#line 1068 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1069 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetFlagOff  (ENF_ALIVE );
#line 1070 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetFlagOn  (ENF_CLIENTHANDLING );
#line 1071 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Destroy  (FALSE );
#line 1072 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Return(STATE_CURRENT,EVoid());
#line 1072 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
return TRUE;
#line 1073 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1074 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fTimeFromStart  = 0.0f;
#line 1076 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(GetModelInstance  ())
#line 1077 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1078 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CSkaTag  tag ;
#line 1079 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
tag  . SetName  ("__ROOT");
#line 1080 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
GetModelInstance  () -> m_tmSkaTagManager  . Register  (& tag );
#line 1081 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1083 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Jump(STATE_CURRENT, STATE_CMissile_Connect, TRUE, EVoid());return TRUE;
#line 1084 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1085 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else 
#line 1086 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1089 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_iFireObjectType  == CSkill  :: MT_DASH )
#line 1090 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1091 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_epSource  -> IsFlagOff  (ENF_INVISIBLE ))
#line 1092 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1093 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_epSource  -> SetFlagOn  (ENF_INVISIBLE );
#line 1094 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1095 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1097 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_bReached  = FALSE ;
#line 1098 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_bReached2  = FALSE ;
#line 1099 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fRatio  = 0.0f;
#line 1100 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fTimeFromStart  = 0.0f;
#line 1101 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fLeftDistance  = 0.0f;
#line 1102 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_bMoveFail  = FALSE ;
#line 1104 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(GetModelInstance  ())
#line 1105 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1106 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CSkaTag  tag ;
#line 1107 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
tag  . SetName  ("__ROOT");
#line 1108 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
GetModelInstance  () -> m_tmSkaTagManager  . Register  (& tag );
#line 1109 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1112 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fHorizonalOffset  = Clamp  (m_fHorizonalOffset  , - 1.0f , 1.0f);
#line 1113 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fVerticalOffset  = Clamp  (m_fVerticalOffset  , - 1.0f , 1.0f);
#line 1114 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_vInitPos  = en_plPlacement  . pl_PositionVector ;
#line 1115 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_bEntityTarget )
#line 1116 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1117 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CTag  * pTag  = m_epTarget  -> GetModelInstance  () -> m_tmSkaTagManager  . Find  ("CENTER");
#line 1118 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(pTag )
#line 1119 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1120 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_vTargetCenterPos  = pTag  -> GetOffsetPos  ();
#line 1121 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
RotateVector  (m_vTargetCenterPos  , pTag  -> GetOffsetRot  ());
#line 1122 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1123 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else 
#line 1124 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1125 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_vTargetCenterPos  = m_epTarget  -> en_plPlacement  . pl_PositionVector ;
#line 1126 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1127 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1130 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT3D vDist ;
#line 1131 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_bEntityTarget )
#line 1132 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1133 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
vDist  = m_epTarget  -> en_plPlacement  . pl_PositionVector  - this  -> en_plPlacement  . pl_PositionVector ;
#line 1134 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1135 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else 
#line 1136 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1137 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
vDist  = m_vTargetPos  - this  -> en_plPlacement  . pl_PositionVector ;
#line 1138 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1139 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOAT fDist  = vDist  . Length  ();
#line 1140 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fTimeRatio  = m_fMoveSpeed  / fDist ;
#line 1141 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
static FLOAT fNoPeakLimit  = 3.0f;
#line 1142 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(! m_bNoPeak ){m_bNoPeak  = fDist  < fNoPeakLimit ;}
#line 1143 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_pssPath  = new  cubic_spline ;
#line 1144 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
GetSpline  () . AddSample  (0.0f , m_vInitPos );
#line 1145 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(! m_bNoPeak )
#line 1146 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1147 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
vDist  *= 0.3f;
#line 1148 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
static FLOAT fDistRatio  = 0.10f;
#line 1149 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
vDist  (2) += fDist  * fDistRatio  * (m_fVerticalOffset  * 0.5f + 0.5f);
#line 1150 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_fHorizonalOffset  != 0.0f)
#line 1151 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1152 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
FLOATquat3D qRot ;
#line 1153 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
static FLOAT fAngle  = 15.0f;
#line 1154 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
qRot  . FromEuler  (ANGLE3D (fAngle  * m_fHorizonalOffset  , 0 , 0));
#line 1155 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
vDist  = VectorRotate  (vDist  , qRot );
#line 1156 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1157 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
GetSpline  () . AddSample  (0.4f , vDist  + this  -> en_plPlacement  . pl_PositionVector );
#line 1158 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1159 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
if(m_bEntityTarget )
#line 1160 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1161 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
RemakeSplinePath  ();
#line 1162 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1163 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
else 
#line 1164 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
{
#line 1165 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
GetSpline  () . AddSample  (1.0f , m_vTargetPos );
#line 1166 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
GetSpline  () . Prepare  ();
#line 1167 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1169 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CPlacement3D plNew ;
#line 1170 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_fRatio  += m_fTimeRatio  * 0.001f;
#line 1171 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
CalcPalacementOnPath  (m_fRatio  , 0 , 0.001f , plNew );
#line 1172 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
SetPlacement  (plNew );
#line 1174 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Jump(STATE_CURRENT, STATE_CMissile_PreBehavior, TRUE, EVoid());return TRUE;
#line 1175 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
}
#line 1177 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
delete  m_pssPath ;
#line 1178 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
m_pssPath  = NULL ;
#line 1179 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Destroy  (FALSE );
#line 1180 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
Return(STATE_CURRENT,EVoid());
#line 1180 "E:/질산/Korea/Client_USA/EntitiesMP/Missile.es"
return TRUE; ASSERT(FALSE); return TRUE;};